version: '2'

services:
  api-test-data:
    env_file: variables.env  
    build: 
      context: portal-api
    volumes:
    - "/var/portal-api/static"

  portal-api:
    depends_on:
    - postgres
    links:
    - postgres:postgres
    env_file: variables.env
    environment:
    - WICKED_STORAGE
    - PORTAL_STORAGE_PGHOST=postgres
    - PORTAL_STORAGE_PGPORT=5432
    image: ${DOCKER_PREFIX}portal-api:${PORTAL_API_TAG}${BUILD_ALPINE}
    volumes_from:
    - "api-test-data"

  postgres:
    image: postgres:9.6.8
    environment:
    - POSTGRES_USER=kong
    - POSTGRES_PASSWORD=kong

#networks:
#  default:
#    driver: bridge
#    ipam:
#      driver: default
#      config:
#      - subnet: 10.222.222.0/24
#        gateway: 10.222.222.1
